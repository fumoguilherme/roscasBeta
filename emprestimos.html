 <!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <title>Roscas |Emprestimos</title>

    <!-- Favicon-->
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&subset=latin,cyrillic-ext" rel="stylesheet" type="text/css">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" type="text/css">

    <!-- Bootstrap Core Css -->
    <link href="plugins/bootstrap/css/bootstrap.css" rel="stylesheet">

    <!-- Waves Effect Css -->
    <link href="plugins/node-waves/waves.css" rel="stylesheet" />

    <!-- Sweetalert Css -->
    <link href="plugins/sweetalert/sweetalert.css" rel="stylesheet" />

    <!-- Animation Css -->
    <link href="plugins/animate-css/animate.css" rel="stylesheet" />

    <!-- Bootstrap Material Datetime Picker Css -->
    <link href="plugins/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css" rel="stylesheet" />


    <!-- Bootstrap Select Css -->
    <link href="plugins/bootstrap-select/css/bootstrap-select.css" rel="stylesheet" />

    <!-- Custom Css -->
    <link href="css/style.css" rel="stylesheet">

    <!-- AdminBSB Themes. You can choose a theme from css/themes instead of get all themes -->
    <link href="css/themes/all-themes.css" rel="stylesheet" />

    <!-- CSS file -->
    <link rel="stylesheet" href="plugins/autocomplete/easy-autocomplete.min.css">

    <!-- Additional CSS Themes file - not required-->
    <link rel="stylesheet" href="plugins/autocomplete/easy-autocomplete.themes.min.css">

</head>

<body class="theme-green">
    <!-- Page Loader -->
    <div class="page-loader-wrapper">
        <div class="loader">
            <div class="preloader">
                <div class="spinner-layer pl-red">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>
            </div>
            <p>Please wait...</p>
        </div>
    </div>
    <!-- #END# Page Loader -->
    <!-- Overlay For Sidebars -->
    <div class="overlay"></div>
    <!-- #END# Overlay For Sidebars -->
    <!-- Search Bar -->
    <div class="search-bar">
        <div class="search-icon">
            <i class="material-icons">search</i>
        </div>
        <input type="text" placeholder="START TYPING...">
        <div class="close-search">
            <i class="material-icons">close</i>
        </div>
    </div>
    <!-- #END# Search Bar -->
    <!-- Top Bar -->
    <nav class="navbar">
        <div class="container-fluid">
            <div class="navbar-header">

                <div class="nav navbar-nav navbar-right">
                    <a class=" navbar-right navbrandimg bg-light-blue collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false" >
                        <span><strong>T </strong> </span>
                    </a>

                    <a href="menu.html" class="navbrandIco"> <i class=" col-white font-40 material-icons">home</i> </a>

                </div>
                <!--<a href="javascript:void(0);" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false"></a>-->



                <!--<span class="navbrand" >ROSCAS</span>-->

            </div>
            <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">

                    <!-- Notifications -->
                    <li class="dropdown">
                        <a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button">
                            <i class="material-icons">person</i>
                            <span id="nome_tecnico"> Técnico</span>
                        </a>
                        <ul class="dropdown-menu pull-right">
                            <li><a href="javascript:void(0);"><i class="material-icons">person</i>Perfil</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="javascript:void(0);"><i class="material-icons">group</i>Grupos</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="index.html"><i class="material-icons">input</i>Sign Out</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- #Top Bar -->

    <section class="content">
        <div class="container-fluid">
            <div class="block-header">
                <h2 class="text-center">Emprestimos do <strong><span id="nome_membro">M1</span></strong></h2>
            </div>
            <!-- Input Group -->
            <div class="row clearfix">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="card">
                        <div class="body">

                            <div class="demo-masked-input">
                                <div class="row clearfix" id="step1">

                                    <div class="col-md-4">
                                        <div class="input-group">
                                        <span class="input-group-addon">
                                            <i class="material-icons">person</i>
                                        </span>
                                            <div class="form-line">
                                                <label type="text" id="membro_nome" name="membro_nome"
                                                       placeholder="ID/Nome"></label>
                                            </div>
                                        </div>
                                    </div>
                                    <br>

                                    <div class="col-md-4">
                                        <b>Capacidade de Endividamento</b>
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                                <i class="material-icons">account_balance_wallet</i>
                                            </span>
                                            <div class="form-line">
                                                <input type="text" id="capacidade" name="capacidade"
                                                       class="form-control date" placeholder="Capacidade" disabled>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-xs-12">
                                        <b>Observações</b>
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                                <i class="material-icons">info_outline</i>
                                            </span>
                                            <div class="form-line">
                                                <textarea rows="4" class="form-control no-resize" placeholder="A capacidade de endividamento é o dobro do valor depositado pelo membro" disabled></textarea>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xs-12">
                                        <b>Valor do Emprestimo</b>
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                                <i class="material-icons">attach_money</i>
                                            </span>
                                            <div class="form-line">
                                                <input type="number" id="valor" name="valor"
                                                       class="form-control date" placeholder="V. Emprestimo">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-xs-12">
                                        <b>Taxa de Juros</b>
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                                <i class="material-icons">account_balance</i>
                                            </span>
                                            <div class="form-line">
                                                <input type="number" id="juros" name="juros"
                                                       class="form-control date" placeholder="Taxa de Juros">
                                            </div>
                                        </div>
                                    </div>

                                    <br>

                                    <div class="col-xs-6  col-md-6 ">
                                        <a id="bt_cancelar" class="btn btn-block bg-light-green  waves-effect">
                                            <i class="material-icons">close</i>
                                            <span>Cancelar</span>
                                        </a>
                                    </div>


                                    <div class="col-xs-6  col-md-6 js-sweetalert">
                                        <a href="#" class="btn btn-block bg-light-green  waves-effect"  id="bt_proximo">
                                            <span>Próximo</span>
                                            <i class="material-icons">arrow_forward</i>

                                        </a>

                                    </div>


                                </div>
                                <div class="row clearfix " id="step2" hidden="hidden">


                                    <br>

                                    <div class="col-md-4">
                                        <b>Valor a pagar</b>
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                                <i class="material-icons">attach_money</i>
                                            </span>
                                            <div class="form-line">
                                                <input type="number" id="valPagar" name="valPagar"
                                                       class="form-control date" placeholder="Valor a pagar" disabled>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-md-4">
                                        <b>Data prevista de Pagamento</b>
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                                 <i class="material-icons">calendar_today</i>
                                            </span>
                                            <div class="form-line">
                                                <input type="text" id="dataPag" name="dataPag"
                                                       class=" datepicker form-control " placeholder="Data Prevista Pagamento" >
                                            </div>
                                        </div>
                                    </div>




                                    <div class="col-xs-6  col-md-6 ">
                                        <a class="btn btn-block bg-light-green  waves-effect" id="bt_cancelar2">
                                            <i class="material-icons">arrow_back</i>
                                            <span>Voltar</span>
                                        </a>
                                    </div>


                                    <div class="col-xs-6  col-md-6 js-sweetalert">
                                        <a class="btn btn-block bg-light-green  waves-effect" id="bt_guardar">
                                            <span>Guardar</span>
                                            <i class="material-icons">save</i>

                                        </a>

                                    </div>


                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>



        </div>
    </section>

    <!-- Jquery Core Js -->
    <script src="plugins/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core Js -->
    <script src="plugins/bootstrap/js/bootstrap.js"></script>

    <!-- Select Plugin Js -->
    <script src="plugins/bootstrap-select/js/bootstrap-select.js"></script>

    <!-- Slimscroll Plugin Js -->
    <script src="plugins/jquery-slimscroll/jquery.slimscroll.js"></script>

    <!-- Bootstrap Notify Plugin Js -->
    <script src="plugins/bootstrap-notify/bootstrap-notify.js"></script>

    <!-- Waves Effect Plugin Js -->
    <script src="plugins/node-waves/waves.js"></script>

    <!-- SweetAlert Plugin Js -->
    <script src="plugins/sweetalert/sweetalert.min.js"></script>

    <!-- Moment Plugin Js -->
    <script src="plugins/momentjs/moment.js"></script>


    <script src="plugins/autosize/autosize.js"></script>


    <!-- Bootstrap Material Datetime Picker Plugin Js -->
    <script src="plugins/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>




    <!-- Custom Js -->
    <script src="js/admin.js"></script>
    <script src="js/pages/ui/dialogs.js"></script>
    <script src="js/pages/forms/basic-form-elements.js"></script>



    <!-- Demo Js -->
    <script src="js/demo.js"></script>


    <script src="js/roscas/config.js"></script>


    <!-- JS file -->
    <script src="plugins/autocomplete/jquery.easy-autocomplete.min.js"></script>

    <script>

        var grupo_codigo = getUrlParameter('token');
        var membro_codigo = getUrlParameter('token1');
        var capacidade = "";

        var url = 'gerirGrupo.html?token=' + grupo_codigo;

        $('#bt_cancelar').attr("href", url);

        $.ajax({
            type: 'POST', //Or 'GET',
            url: ip+"php/controller/pesquisar/dadosTecnico.php",
            success: function (data) {

                var result = JSON.parse(data);

                var nome = result.nome_tecnico;
                var email = result.email_tecnico;


                $('#nome_tecnico').text(nome);
                $('#email_tecnico').text(email);


                return false;
            },
            error: function () {

                alert("ocorreu um erro");

                return false;
            }
        });

        $.ajax({
            type: 'POST', //Or 'GET',
            url: ip+"php/controller/pesquisar/capacidadeDivida.php?membro_id=" + membro_codigo + "&grupo_id=" + grupo_codigo,
            success: function (data) {

                var result = JSON.parse(data);

                if(result.estado === 'sucesso'){

                    $("#membro_nome").text(result.membro_nome);
                    $("#nome_membro").text(result.membro_nome);
                    $("#capacidade").val(result.membro_capacidade);
                    $("#juros").val(result.grupo_taxa);
                    capacidade = result.capacidade_nao_formatado;
                }else if(result.estado === 'erro'){

                    swal({

                        title: "Erro!",
                        text: "Problemas ao se conectar a internet<br><br>" +
                        "<div class='row col-md-12'>" +
                        "<div class='col-md-6'>" +
                        "</div> " +
                        "</div> ",
                        type: "error",
                        showConfirmButton: true,
                        html: true
                    });

                }else{
                    swal({

                        title: "Erro!",
                        text: "Problemas ao se conectar a internet<br><br>" +
                        "<div class='row col-md-12'>" +
                        "<div class='col-md-6'>" +
                        "</div> " +
                        "</div> ",
                        type: "error",
                        showConfirmButton: true,
                        html: true
                    });

                }

                return false;
            },
            error: function () {

                alert("ocorreu um erro");

                return false;
            }
        });


        $("#valor").change(function() {


           if(parseFloat($('#valor').val()) > parseFloat(capacidade)) {

               swal({

                   title: "Capacidade de endividamento!",
                   text: "O valor solicitado é maior que a capacidade do membro. Prosseguir?<br><br>" +
                   "<div class='row col-md-12'>" +
                   "<div class='col-md-6'>" +
                   "</div> " +
                   "</div> ",
                   type: "warning",
                   showConfirmButton: true,
                   html: true
               });
           }

        });





        //Controle dos steps
        $('#bt_proximo').on('click', function () {


            if($('#valor').val().length === 0 || $('#juros').val().length === 0){

                swal({

                    title: "Preencha todos campos!",
                    text: "Os campos não podem estar vazios<br><br>" +
                    "<div class='row col-md-12'>" +
                    "<div class='col-md-6'>" +
                    "</div> " +
                    "</div> ",
                    type: "warning",
                    showConfirmButton: true,
                    html: true
                });

            }else if($('#valor').val() === '0' || parseFloat($('#valor').val()) < 0) {

                swal({

                    title: "Valor inválido!",
                    text: "Não pode fazer empréstimo desse valor<br><br>" +
                    "<div class='row col-md-12'>" +
                    "<div class='col-md-6'>" +
                    "</div> " +
                    "</div> ",
                    type: "warning",
                    showConfirmButton: true,
                    html: true
                });


            }else{
                var valorPagar = parseFloat($('#valor').val())  +  (parseFloat($('#valor').val()) * parseFloat($('#juros').val())) / 100;


                $('#valPagar').val(valorPagar);



                $('#step1').hide();
                $('#step2').show();

            }

        });

        $('#bt_guardar').on('click', function () {

            event.preventDefault();

            if($('#dataPag').val().length === 0){
                swal({

                    title: "Preencha todos campos!",
                    text: "Os campos não podem estar vazios<br><br>" +
                    "<div class='row col-md-12'>" +
                    "<div class='col-md-6'>" +
                    "</div> " +
                    "</div> ",
                    type: "warning",
                    showConfirmButton: true,
                    html: true
                });
            }else{

                var v_emprestimo = $('#valor').val();
                var taxa_juro = $('#juros').val();
                var dataPag = $('#dataPag').val();

                $.ajax({
                    type: 'POST', //Or 'GET',
                    url: ip+"php/controller/adicionar/addEmprestimo.php?membro_id=" + membro_codigo + "&grupo_id=" + grupo_codigo +
                    "&valor_emprestimo="+v_emprestimo+"&taxa_juro="+taxa_juro+"&data_pagamento="+dataPag,
                    success: function (data) {

                        var result = JSON.parse(data);

                        if(result.estado === 'sucesso'){
                            swal({

                                title: "Sucesso!",
                                text: "O empréstimo foi submetido<br><br>" +
                                "<a class='btn btn-block bg-blue-grey waves-effect col-md-6' id ='emprestimo'>Menu Emprestimo</a>" +
                                "<div class='row col-md-12'>" +
                                "<div class='col-md-6'>" +
                                "</div> " +
                                "</div> ",
                                type: "success",
                                showConfirmButton: false,
                                html: true
                            });

                            var url = 'tabelaEmprestimos.html?token=' + grupo_codigo;

                            $('#emprestimo').attr("href", url);


                        }else{
                            swal({

                                title: "Erro!",
                                text: "Não foi possível processar este pedido<br><br>" +
                                "<div class='row col-md-12'>" +
                                "<div class='col-md-6'>" +
                                "</div> " +
                                "</div> ",
                                type: "warning",
                                showConfirmButton: true,
                                html: true
                            });
                        }

                        return false;
                    },
                    error: function () {

                        alert("ocorreu um erro");

                        return false;
                    }
                });

            }


        });

        $('#bt_cancelar2').on('click', function () {

            $('#step1').show();
            $('#step2').hide();



        });




        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

    </script>

</body>

</html>
